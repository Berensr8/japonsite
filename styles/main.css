*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0f1115;--bg-alt:#181b22;--accent:#6d5dfc;--accent-grad:linear-gradient(135deg,#6d5dfc,#8f7bff);--text:#f5f7fb;--text-dim:#9aa2b5;--danger:#ff4d61;--ok:#3ddc97;--warn:#ffb347;--radius:18px;--glass:rgba(255,255,255,.06);--border:1px solid rgba(255,255,255,.08);--shadow:0 4px 24px -4px rgba(0,0,0,.6);
  font-family:'Inter',system-ui,sans-serif;
}
/* Light Sakura Theme */
:root.light{--bg:#f8f5f7;--bg-alt:#ffffffcc;--text:#2c2f33;--text-dim:#6d6f75;--accent:#d1499b;--accent-grad:linear-gradient(135deg,#e66ab4,#d1499b);--glass:rgba(255,255,255,.55);--border:1px solid rgba(210,160,190,.35);--shadow:0 4px 24px -4px rgba(180,90,140,.25)}
:root.light body{background:radial-gradient(circle at 25% 20%,#ffe3ef,#f8f5f7 60%)}
:root.light .quiz-card,:root.light .game-tile,:root.light .game-area,.light .table-group{backdrop-filter:blur(18px) saturate(170%)}
:root.light button{color:var(--text-dim)}
:root.light .grp-item{background:var(--bg-alt)}
:root.light .grp-item.on{box-shadow:0 4px 14px -4px #d1499b66;background:var(--accent-grad);color:#fff;border:none}
:root.light .grp-item .char-mini{background:rgba(0,0,0,.06);color:var(--text-dim)}
:root.light .grp-item.on .char-mini{background:rgba(255,255,255,.28);color:#fff}
:root.light #drawCanvas{background:#fff1f7}

/* Sakura petals */
.petal{position:fixed;top:-40px;background:radial-gradient(circle at 30% 30%,#ffd4ec,#ffb8de 60%,#ff9fd2);border-radius:60% 40% 60% 40%;pointer-events:none;z-index:2;opacity:.85;animation:fall linear forwards}
@keyframes fall{0%{transform:translateY(0) rotate(0deg) scale(.8);}100%{transform:translateY(110vh) rotate(360deg) scale(1);} }
body{background:radial-gradient(circle at 20% 20%,#1c2230,#0f1115 60%);color:var(--text);min-height:100vh;line-height:1.5;-webkit-font-smoothing:antialiased;padding-top:70px;transition:background .6s, color .4s}
header.site-header{position:fixed;top:0;left:0;right:0;height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 28px;z-index:20}
.glass{background:var(--glass);backdrop-filter:blur(14px) saturate(150%);border:var(--border);border-radius:var(--radius)}
.logo{font-weight:700;font-size:1.25rem;letter-spacing:.5px}
.logo span{background:var(--accent-grad);-webkit-background-clip:text;background-clip:text;color:transparent}
nav a{color:var(--text-dim);text-decoration:none;margin-left:20px;font-weight:500;transition:.25s}
nav a:hover{color:var(--text)}
.hero{max-width:900px;margin:0 auto;padding:80px 24px 50px;text-align:center}
.hero h1{font-size:clamp(2.4rem,6vw,3.5rem);line-height:1.1;margin-bottom:22px;background:var(--accent-grad);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:700}
.hero p{font-size:1.1rem;color:var(--text-dim);margin-bottom:32px}
.actions button{margin:0 8px}
button{cursor:pointer;font:inherit;border:none;padding:14px 24px;border-radius:14px;font-weight:600;letter-spacing:.5px;display:inline-flex;align-items:center;gap:6px;transition:.25s;background:var(--bg-alt);color:var(--text-dim);border:var(--border)}
button.primary{background:var(--accent-grad);color:#fff;border:none}
button.secondary{background:var(--glass);color:var(--text)}
button.ghost{background:transparent;color:var(--text-dim);border:var(--border)}
button:hover{transform:translateY(-2px);box-shadow:0 6px 18px -6px rgba(0,0,0,.5);color:var(--text)}
button:active{transform:translateY(0)}
main{max-width:1100px;margin:0 auto;padding:0 24px 120px;position:relative}
/* Right floating group panel */
.group-panel{position:fixed;top:90px;right:24px;width:270px;max-height:75vh;overflow:auto;padding:18px 16px;display:flex;flex-direction:column;gap:14px;z-index:30}
.group-panel h4{font-size:.85rem;letter-spacing:.5px;text-transform:uppercase;color:var(--text-dim)}
.group-panel .panel-hint{font-size:.65rem;color:var(--text-dim);line-height:1.3}
.groups.compact .grp-item{padding:10px 12px;font-size:.72rem;border-radius:12px}
@media (max-width:1080px){.group-panel{position:static;width:auto;max-height:none;margin-top:30px;order:3}}
.panel{margin-top:40px}
.panel h2{font-size:2rem;margin-bottom:20px;font-weight:600}
.quiz-card{max-width:420px;padding:32px;margin:16px 0;display:flex;flex-direction:column;align-items:center;gap:18px;box-shadow:var(--shadow)}
.quiz-card .char{font-size:6rem;font-weight:600;line-height:1}
.quiz-card input{width:100%;padding:14px 16px;border-radius:12px;background:var(--bg-alt);border:var(--border);color:var(--text);font-size:1.15rem}
.quiz-card input:focus{outline:2px solid #6d5dfc44}
.feedback{min-height:28px;font-weight:600}
.progress-wrap{width:100%;height:10px;background:#1f2531;border-radius:6px;overflow:hidden;margin:10px 0 30px}
.progress-bar{height:100%;width:0;background:var(--accent-grad);transition:width .4s}
.session-stats{font-size:.95rem;color:var(--text-dim);margin-top:-10px}
.learning-stats{font-size:.85rem;color:var(--text-dim);margin-top:6px;white-space:pre-wrap}
.mode-tabs{display:flex;gap:10px;margin:6px 0 10px}
.mode-tabs .tab{flex:0 0 auto;padding:10px 16px;border-radius:40px;background:var(--bg-alt);border:var(--border);font-size:.8rem;font-weight:600;letter-spacing:.5px;color:var(--text-dim);cursor:pointer;transition:.25s}
.mode-tabs .tab.active{background:var(--accent-grad);color:#fff;border:none}
.mastery-pill{display:inline-block;padding:2px 8px;border-radius:20px;font-size:.65rem;font-weight:600;background:#2b3242;margin:2px 4px 2px 0}
.mastery-pill.done{background:var(--ok);color:#0f1115}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-top:10px}
.stat-box{padding:26px 20px;text-align:center;box-shadow:var(--shadow)}
.stat-box span{display:block;font-size:2.2rem;font-weight:700;margin-bottom:6px;background:var(--accent-grad);-webkit-background-clip:text;background-clip:text;color:transparent}
.games-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:32px}
.games-grid{--grid-min:260px}
@media (min-width:880px){
  .games-grid{grid-template-columns:repeat(3,1fr);align-items:stretch}
  .games-grid .game-tile.featured{grid-column:1 / -1;display:grid;grid-template-columns:320px 1fr;min-height:260px;}
  .games-grid .game-tile.featured .game-icon{width:100%;height:100%;font-size:4rem;border-radius:28px;align-self:stretch;justify-self:stretch;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent) 0%,#ff7ac6 90%);color:#fff;box-shadow:0 10px 34px -8px rgba(0,0,0,.55);}
  :root.light .games-grid .game-tile.featured .game-icon{background:linear-gradient(135deg,#ff8ccf,#d1499b)}
  .games-grid .game-tile.featured .game-body{padding-left:30px;display:flex;flex-direction:column;justify-content:center}
  .games-grid .game-tile.featured h3{font-size:2rem}
  .games-grid .game-tile.featured p{font-size:1rem;max-width:640px}
  .games-grid .game-tile.featured button.full{align-self:flex-start;width:auto;padding:16px 34px;margin-top:18px}
  .games-grid .game-tile.featured .game-meta{position:absolute;top:16px;right:20px}
}
@media (max-width:879.98px){
  .games-grid .game-tile.featured{order:4}
}
.game-tile{--tile-pad:22px;position:relative;display:flex;flex-direction:column;padding:var(--tile-pad);gap:14px;box-shadow:var(--shadow);overflow:hidden;isolation:isolate;min-height:230px}
.game-tile{opacity:0;transform:translateY(18px) scale(.98);animation:tileIn .7s cubic-bezier(.16,.68,.37,1) forwards;}
.game-tile:nth-child(1){animation-delay:.05s}
.game-tile:nth-child(2){animation-delay:.12s}
.game-tile:nth-child(3){animation-delay:.19s}
.game-tile:nth-child(4){animation-delay:.26s}
@keyframes tileIn{to{opacity:1;transform:translateY(0) scale(1)}}
.game-tile:before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(circle at 120% 0,rgba(255,255,255,.12),transparent 60%);opacity:0;transition:.5s}
.game-tile:after{content:"";position:absolute;inset:0;pointer-events:none;background:linear-gradient(120deg,rgba(255,255,255,.08),transparent 40%);mix-blend-mode:overlay;opacity:.35;transition:.4s}
.game-tile:hover:before{opacity:1;transform:scale(1.06)}
.game-tile:hover{transform:translateY(-6px);}
@media (hover:none){.game-tile:hover{transform:none}}
.game-tile h3{font-size:1.2rem;font-weight:600;letter-spacing:.5px}
.game-tile p{color:var(--text-dim);font-size:.86rem;line-height:1.35;margin-top:2px}
.game-icon{width:54px;height:54px;display:flex;align-items:center;justify-content:center;font-size:1.65rem;border-radius:16px;background:rgba(255,255,255,.08);box-shadow:0 4px 14px -4px #00000080}
.game-meta{font-size:.65rem;font-weight:600;letter-spacing:.6px;text-transform:uppercase;color:var(--text-dim);display:flex;align-items:center;gap:6px;margin-top:auto}
.game-meta .last-score{background:rgba(255,255,255,.08);padding:4px 8px;border-radius:10px;font-size:.6rem;font-weight:600;letter-spacing:.5px;color:var(--text-dim);max-width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}
.game-tile button.full{margin-top:4px;width:100%;justify-content:center}
.game-tile button.full{background:var(--bg-alt)}
.game-tile button.full:hover{background:var(--accent-grad);color:#fff;border:none}
.game-area{margin-top:40px;padding:30px;box-shadow:var(--shadow)}
@media (max-width:640px){.game-tile{min-height:unset}.games-grid{gap:22px}}
@media (hover:none){.game-tile:hover{transform:none}}
/* Light theme tweaks */
:root.light .game-icon{background:rgba(0,0,0,.06)}
:root.light .game-meta .last-score{background:rgba(0,0,0,.06)}
.draw-wrap{display:grid;grid-template-columns:220px 1fr;gap:26px;align-items:start;max-width:860px}
.draw-target{font-size:2.2rem;font-weight:700;margin-bottom:14px}
.draw-left{display:flex;flex-direction:column}
.draw-controls{display:flex;flex-direction:column;gap:8px;font-size:.75rem;color:var(--text-dim)}
.draw-controls select{background:var(--bg-alt);border:var(--border);color:var(--text);padding:6px 10px;border-radius:10px;font:inherit}
#drawCanvas{background:#10151d;border:var(--border);border-radius:16px;touch-action:none;cursor:crosshair}
.draw-status{font-size:.75rem;color:var(--text-dim)}
@media (max-width:780px){.draw-wrap{grid-template-columns:1fr}#drawCanvas{width:100%;height:auto}}
footer{padding:40px 0;margin-top:60px;text-align:center;color:var(--text-dim);font-size:.85rem}
.hidden{display:none!important}
.score-history{margin-top:34px;font-size:.75rem;color:var(--text-dim)}
.score-history h4{margin-bottom:8px;font-size:.85rem;font-weight:600;color:var(--text)}
.score-list{display:flex;flex-direction:column;gap:4px;max-width:560px}
.score-item{padding:6px 10px;border:var(--border);border-radius:10px;background:var(--bg-alt)}
.draw-controls input[type=color]{width:42px;height:32px;padding:0;border-radius:8px;cursor:pointer}
.draw-controls input[type=range]{width:110px}
/* Memory game */
.memory-columns{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:26px;margin-top:14px}
.mem-col{display:flex;flex-direction:column;gap:10px}
.mem-card{background:var(--bg-alt);border:var(--border);padding:12px 14px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;cursor:pointer;transition:.25s;font-weight:600}
.mem-card.side-right{font-size:1rem;text-transform:lowercase;letter-spacing:.5px;font-weight:500}
.mem-card:hover{background:#222a36}
.mem-card.active{outline:2px solid #6d5dfc99}
.mem-card.matched{background:var(--ok);color:#0f1115;border:none}
.memory-config, .typing-config{margin:6px 0 10px;font-size:.8rem;color:var(--text-dim);display:flex;align-items:center;gap:10px}
.memory-config select, .typing-config select{background:var(--bg-alt);border:var(--border);color:var(--text);padding:6px 10px;border-radius:10px;font:inherit}
.memory-config button, .typing-config button{padding:8px 16px}
/* Typing game */
.typing-wrap{display:flex;flex-direction:column;gap:14px;max-width:520px}
.typing-target{font-size:4rem;font-weight:600}
.flash-wrap{display:flex;flex-direction:column;align-items:center;gap:18px}
.flash-card{width:180px;height:240px;perspective:1000px;cursor:pointer}
.flash-inner{position:relative;width:100%;height:100%;transition:transform .6s;transform-style:preserve-3d}
.flash-card.flipped .flash-inner{transform:rotateY(180deg)}
.flash-face{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:600;border-radius:18px;background:var(--bg-alt);border:var(--border);backface-visibility:hidden}
.flash-back{transform:rotateY(180deg);font-size:1.4rem;padding:8px;flex-direction:column;gap:8px;text-align:center}
.badge{display:inline-block;background:var(--accent-grad);padding:4px 10px;border-radius:40px;font-size:.7rem;font-weight:600;letter-spacing:.5px;margin-left:8px}
.feedback.ok{color:var(--ok)}
.feedback.err{color:var(--danger)}
/* Group selection */
.group-select{margin:4px 0 10px;font-size:.8rem}
.group-select summary{cursor:pointer;list-style:none;font-weight:600;margin-bottom:6px}
.groups{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px;margin-top:10px}
.grp-item{display:flex;align-items:center;gap:10px;font-size:.85rem;background:var(--bg-alt);padding:12px 16px;border-radius:14px;border:var(--border);cursor:pointer;transition:.25s;font-weight:500;line-height:1.2}
.grp-item{position:relative;flex-wrap:wrap}
.grp-item .grp-label{flex:1 0 100%}
.grp-item .grp-chars{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap;max-width:100%}
.grp-item .char-mini{background:rgba(255,255,255,.08);padding:4px 6px;border-radius:8px;font-size:.75rem;font-weight:600;line-height:1;color:var(--text-dim);min-width:22px;text-align:center}
.grp-item.on .char-mini{background:rgba(255,255,255,.18);color:#fff}
.groups.compact .grp-item{padding:10px 12px}
.groups.compact .grp-item .char-mini{font-size:.65rem;padding:3px 5px}
.grp-item:hover{background:#202632}
.grp-item input{accent-color:#6d5dfc;cursor:pointer;transform:scale(1.2)}
.grp-item.on{background:var(--accent-grad);color:#fff;border:none;box-shadow:0 4px 14px -4px #6d5dfc66}
.grp-item.on input{filter:brightness(1.2)}
/* Test mode choices */
.choice-area{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;width:100%;margin-top:4px}
.choice-btn{background:var(--bg-alt);border:var(--border);padding:10px 12px;border-radius:12px;font-size:.95rem;font-weight:600;text-transform:lowercase;justify-content:center}
.choice-btn:hover{background:var(--accent-grad);color:#fff;border:none}
.choice-btn.correct{background:var(--ok)!important;color:#0f1115!important;border:none}
.choice-btn.wrong{background:var(--danger)!important;color:#fff!important;border:none}
.test-status{font-size:.8rem;color:var(--text-dim);margin-top:-8px}
.quiz-card.test-layout{display:grid;grid-template-columns:140px 1fr;align-items:start;gap:28px;max-width:760px}
.quiz-card.test-layout .char{grid-column:1;justify-self:center}
.quiz-card.test-layout #choiceArea{grid-column:2}
.quiz-card.test-layout #answerInput,.quiz-card.test-layout .controls{display:none}
@media (max-width:760px){.quiz-card.test-layout{grid-template-columns:1fr}.quiz-card.test-layout #choiceArea{grid-column:1}.quiz-card.test-layout .char{justify-self:center}}
/* Hiragana table */
.hiragana-table{margin-top:16px}
.table-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:22px}
.table-group{background:var(--glass);border:var(--border);border-radius:18px;padding:16px 18px;backdrop-filter:blur(10px) saturate(150%);display:flex;flex-direction:column;gap:10px;min-height:140px}
.group-head{font-size:.8rem;font-weight:600;letter-spacing:.5px;color:var(--text-dim);text-transform:uppercase}
.group-row{display:flex;flex-wrap:wrap;gap:10px}
.kana-cell{background:var(--bg-alt);border:var(--border);border-radius:14px;padding:10px 12px;display:flex;flex-direction:column;align-items:center;min-width:60px;flex:0 0 auto;transition:.25s}
.kana-cell:hover{background:#232b39}
.kana-cell .kana{font-size:1.9rem;font-weight:600;line-height:1}
.kana-cell .romaji{font-size:.75rem;color:var(--text-dim);margin-top:3px;letter-spacing:.5px}
::-webkit-scrollbar{width:10px}::-webkit-scrollbar-track{background:#111}::-webkit-scrollbar-thumb{background:#2a3141;border-radius:20px}::-webkit-scrollbar-thumb:hover{background:#353f54}
@media (max-width:680px){header.site-header{padding:0 16px}nav a{margin-left:12px;font-size:.85rem}.quiz-card{padding:26px}.quiz-card .char{font-size:4.5rem}}

/* --- Added modern typing input styles --- */
.typing-input-wrap{position:relative;display:flex;flex-direction:column}
.typing-input-wrap input{background:transparent;border:none;border-bottom:2px solid #2a3141;padding:10px 4px;font-size:1.15rem;color:var(--text);font-family:inherit;letter-spacing:.5px;outline:none;transition:.3s}
.typing-input-wrap input:focus{border-color:var(--accent)}
.typing-input-wrap .ti-underline{position:absolute;left:0;bottom:0;height:2px;width:0;background:var(--accent-grad);transition:.35s}
.typing-input-wrap input:focus + .ti-underline{width:100%}

/* --- Draw control grouping & guide --- */
.ctrl-groups{display:flex;flex-direction:column;gap:10px}
.ctrl-box{background:var(--bg-alt);border:var(--border);padding:10px 12px;border-radius:14px;display:flex;flex-direction:column;gap:6px;position:relative}
.ctrl-box.small-row{flex-direction:row;align-items:center;justify-content:space-between}
.ctrl-box.actions{flex-direction:row;gap:10px;flex-wrap:wrap}
.ctrl-box select,.ctrl-box input[type=number]{background:#141a24;border:var(--border);color:var(--text);padding:6px 10px;border-radius:10px;font:inherit}
.ctrl-box input[type=range]{width:120px}
.ctrl-box label{font-size:.68rem;text-transform:uppercase;letter-spacing:.7px;font-weight:600;color:var(--text-dim);display:flex;flex-direction:column;gap:4px}
.ctrl-box .color-label{flex-direction:row;align-items:center;gap:6px;text-transform:none;letter-spacing:.5px}
.ctrl-box input[type=color]{width:40px;height:34px;padding:0;border:none;border-radius:10px;background:#141a24}
.draw-status{margin-top:4px}

/* Light theme overrides for draw controls */
:root.light .ctrl-box select,
:root.light .ctrl-box input[type=number]{background:#ffffffcc;color:var(--text);border:1px solid rgba(210,160,190,.55)}
:root.light .ctrl-box input[type=color]{background:#ffffffcc;border:1px solid rgba(210,160,190,.55)}

/* Modal (custom confirm) */
.modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);backdrop-filter:blur(3px);z-index:200;animation:fadeIn .25s}
.modal-overlay.closing{animation:fadeOut .18s forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
.modal{min-width:300px;max-width:360px;padding:26px 24px;display:flex;flex-direction:column;gap:16px;box-shadow:var(--shadow);border-radius:20px}
.modal h4{margin:0;font-size:1.05rem;font-weight:600}
.modal .modal-text{font-size:.8rem;line-height:1.4;color:var(--text-dim)}
.modal .actions{display:flex;justify-content:flex-end;gap:10px}
.modal .score-badge{align-self:flex-start;background:var(--accent-grad);padding:6px 12px;border-radius:14px;font-weight:600;font-size:.85rem;letter-spacing:.5px;color:#fff}
:root.light .modal-overlay{background:rgba(255,220,240,.55)}
